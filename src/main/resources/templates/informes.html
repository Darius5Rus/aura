<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Informes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-light">

    <!-- FRAGMENT DE NAVBAR -->
<div th:replace="fragments/navbar :: navbar"></div>

<div class="container mt-4">

    <!-- Género + Estrellas -->
    <div class="row justify-content-center mb-5">

        <div class="col-sm-6  text-center mb-4">
            <h4>Clientes por género</h4>
            <div style="height: 180px;">
                <canvas id="graficoGenero"></canvas>
            </div>
        </div>

        <div class="col-sm-6  text-center mb-4">
            <h4>Reviews por estrellas</h4>
            <div style="height: 180px;">
                <canvas id="graficoEstrellas"></canvas>
            </div>
        </div>

    </div>

    <!-- Edad + Tolerancia -->
    <div class="row justify-content-center mb-5">

        <div class="col-sm-6 text-center mb-4">
            <h4>Clientes por franjas de edad</h4>
            <div style="height: 180px;">
                <canvas id="graficoEdad"></canvas>
            </div>
        </div>

        <div class="col-sm-6 text-center mb-4">
		    <h4>Clientes por tolerancia</h4>
		    <div style="height: 180px;">
		        <canvas id="graficoTolerancia"></canvas>
		    </div>
        </div>

    </div>
</div>

<script th:inline="javascript">

    const labelsGenero = /*[[${labelsGenero}]]*/ [];
    const valoresGenero = /*[[${valoresGenero}]]*/ [];

    const labelsEstrellas = /*[[${labelsEstrellas}]]*/ [];
    const valoresEstrellas = /*[[${valoresEstrellas}]]*/ [];

    const labelsEdad = /*[[${labelsEdad}]]*/ [];
    const valoresEdad = /*[[${valoresEdad}]]*/ [];

    const labelsTolerancia = /*[[${labelsTolerancia}]]*/ [];
    const valoresTolerancia = /*[[${valoresTolerancia}]]*/ [];

    new Chart(document.getElementById('graficoGenero'), {
        type: 'pie',
        data: {
            labels: labelsGenero,
            datasets: [{
                data: valoresGenero,
                backgroundColor: ['#007bff', '#dc3545', '#ffc107', '#28a745']
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    new Chart(document.getElementById('graficoEstrellas'), {
        type: 'bar',
        data: {
            labels: labelsEstrellas,
            datasets: [{
                label: 'Cantidad de reviews',
                data: valoresEstrellas,
                backgroundColor: '#17a2b8'
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    new Chart(document.getElementById('graficoEdad'), {
        type: 'bar',
        data: {
            labels: labelsEdad,
            datasets: [{
                label: 'Clientes',
                data: valoresEdad,
                backgroundColor: '#6f42c1'
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    new Chart(document.getElementById('graficoTolerancia'), {
        type: 'pie',
        data: {
            labels: labelsTolerancia,      // ["Tolerante", "Intolerante"]
            datasets: [{
                data: valoresTolerancia,   // [cantidadTolerantes, cantidadIntolerantes]
                backgroundColor: ['#20c997', '#dc3545']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });

</script>

    <!-- FRAGMENT DE FOOTER -->
<div th:replace="fragments/footer :: footer"></div>

</body>
</html>
